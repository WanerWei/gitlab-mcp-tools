# 项目架构文档

## 项目结构

```
src/
├── config/          # 配置管理
│   └── index.ts     # 应用配置
├── tools/           # 工具实现
│   ├── base.ts      # 工具基类
│   ├── registry.ts  # 工具注册器
│   ├── createMr.ts  # 创建MR工具
│   └── diff.ts      # 获取Diff工具
├── types/           # 类型定义
│   └── index.ts     # 全局类型
├── utils/           # 工具函数
│   ├── logger.ts    # 日志系统
│   ├── errorHandler.ts # 错误处理
│   └── gitlabConfig.ts # GitLab配置
├── mcpServer.ts     # MCP服务器
└── index.ts         # 应用入口
```

## 设计原则

### 1. 模块化设计
- 每个工具都是独立的类，继承自BaseTool
- 配置、日志、错误处理都是独立的模块
- 使用依赖注入和接口隔离原则

### 2. 类型安全
- 使用TypeScript提供完整的类型检查
- 使用Zod进行运行时参数验证
- 定义清晰的接口和类型

### 3. 错误处理
- 统一的错误处理机制
- 分类错误类型（API、验证、网络等）
- 详细的错误日志和上下文信息

### 4. 配置管理
- 环境变量驱动的配置
- 配置验证和默认值处理
- 支持不同环境的配置

### 5. 日志系统
- 分级日志（debug、info、warn、error）
- 时间戳和上下文信息
- 可配置的日志级别

## 核心组件

### BaseTool
所有工具的基类，提供：
- GitLab客户端管理
- 统一的错误处理
- 响应格式化

### ToolRegistry
工具注册器，提供：
- 工具注册和查找
- 工具列表管理
- 扩展性支持

### Logger
日志系统，提供：
- 分级日志输出
- 时间戳格式化
- 可配置的日志级别

### ErrorHandler
错误处理器，提供：
- 错误分类和解析
- 统一的错误响应格式
- 详细的错误信息

## 扩展指南

### 添加新工具
1. 创建新的工具类，继承BaseTool
2. 实现必要的抽象方法
3. 在registry.ts中注册工具
4. 添加相应的类型定义

### 添加新配置
1. 在config/index.ts中添加配置项
2. 更新AppConfig接口
3. 在相应的模块中使用配置

### 添加新工具函数
1. 在utils/目录下创建新文件
2. 定义清晰的接口
3. 添加适当的错误处理
4. 更新类型定义 